{% extends 'base.html' %}
{% block title %}Admin Dashboard{% endblock %}
{% block content %}
<div class="admin-container">
  
  <!-- Tabs -->
  <div class="tabs">
    <button class="tab-btn active" onclick="openTab(event, 'Dashboard')">Dashboard</button>
    <button class="tab-btn" onclick="openTab(event, 'Schools')">Manage Schools</button>
    <button class="tab-btn" onclick="openTab(event, 'Users')">User Management</button>
  </div>

  <!-- Dashboard Content -->
  <div id="Dashboard" class="tab-content" style="display:block;">
    <h2>Overview</h2>
    <div class="stats-grid">
      <div class="stat-card">
        <h3>{{ stats.schools }}</h3>
        <p>Total Schools</p>
      </div>
      <div class="stat-card">
        <h3>{{ stats.users }}</h3>
        <p>Registered Users</p>
      </div>
    </div>
    
    <h3>Most Viewed Schools</h3>
    <div class="most-viewed-list">
      {% for school in most_viewed %}
        <div class="view-item">
          <span class="view-count">{{ school.views }} views</span>
          <span>{{ school.name }}</span>
        </div>
      {% endfor %}
    </div>
  </div>

  <!-- Schools Content -->
  <div id="Schools" class="tab-content">
    <h3>Add New School</h3>
    <form method="post" class="school-form">
      <input type="hidden" name="add_school" value="true">
      <div class="form-row">
        <input name="name" placeholder="School Name" required>
        <select name="type">
          <option value="public">Public</option>
          <option value="private">Private</option>
        </select>
      </div>
      <div class="form-row">
        <input name="place" placeholder="City" required>
        <input name="address" placeholder="Full Address" required>
      </div>
      <div class="form-row">
        <input name="lat" placeholder="Latitude (e.g. 14.123)" type="number" step="any">
        <input name="lng" placeholder="Longitude (e.g. 121.456)" type="number" step="any">
      </div>
      <div class="form-row">
        <input name="contact" placeholder="Contact No.">
        <input name="socials" placeholder="Facebook Link">
      </div>
      <div class="form-row">
        <input name="tuition" placeholder="Tuition Fee">
        <input name="slots" placeholder="Slots Status">
      </div>
      <textarea name="programs" placeholder="Programs Offered" rows="2"></textarea>
      <textarea name="desc" placeholder="Description" rows="2"></textarea>
      <div class="form-row">
        <input name="img" placeholder="Image URL">
        <input name="link" placeholder="Website Link">
      </div>
      <button type="submit" class="primary">Add School</button>
    </form>

    <h3 style="margin-top:30px;">Existing Schools</h3>
    <table class="data-table">
      <thead>
        <tr>
          <th>Name</th>
          <th>Type</th>
          <th>Views</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for school in schools %}
        <tr>
          <td>{{ school.name }}</td>
          <td>{{ school.type }}</td>
          <td>{{ school.views }}</td>
          <td>
            <a href="{{ url_for('admin_delete_school', school_id=school.id) }}" class="delete-link" onclick="return confirm('Delete?')">Delete</a>
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>

  <!-- Users Content -->
  <div id="Users" class="tab-content">
    <h2>User Management</h2>
    <table class="data-table">
      <thead>
        <tr>
          <th>Email</th>
          <th>Name</th>
          <th>Role</th>
          <th>Status</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
        <tr>
          <td>{{ user.email }}</td>
          <td>{{ user.name }}</td>
          <td>{{ 'Admin' if user.is_admin else 'Student' }}</td>
          <td>
            <span class="status-badge {{ 'active' if user.is_active else 'banned' }}">
              {{ 'Active' if user.is_active else 'Banned' }}
            </span>
          </td>
          <td>
            {% if not user.is_admin %}
              <a href="{{ url_for('admin_ban_user', email=user.email) }}" class="action-btn">
                {{ 'Ban' if user.is_active else 'Activate' }}
              </a>
            {% endif %}
          </td>
        </tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
</div>

<script>
function openTab(evt, tabName) {
  var i, content, tabs;
  content = document.getElementsByClassName("tab-content");
  for (i = 0; i < content.length; i++) {
    content[i].style.display = "none";
  }
  tabs = document.getElementsByClassName("tab-btn");
  for (i = 0; i < tabs.length; i++) {
    tabs[i].className = tabs[i].className.replace(" active", "");
  }
  document.getElementById(tabName).style.display = "block";
  evt.currentTarget.className += " active";
}
</script>

<style>
  .admin-container { padding: 20px; max-width: 1000px; margin: 0 auto; }
  .tabs { display: flex; border-bottom: 2px solid #ddd; margin-bottom: 20px; }
  .tab-btn { padding: 10px 20px; border: none; background: none; cursor: pointer; font-size: 16px; color: #666; }
  .tab-btn.active { border-bottom: 3px solid #2E7D32; color: #2E7D32; font-weight: bold; }
  .tab-content { display: none; animation: fadeEffect 0.5s; }
  
  .stats-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 20px; margin-bottom: 30px; }
  .stat-card { background: white; padding: 20px; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); text-align: center; }
  .stat-card h3 { margin: 0; font-size: 36px; color: #2E7D32; }
  
  .data-table { width: 100%; border-collapse: collapse; background: white; border-radius: 8px; overflow: hidden; }
  .data-table th, .data-table td { padding: 12px; text-align: left; border-bottom: 1px solid #eee; }
  .data-table th { background: #f5f5f5; }
  
  .school-form { display: grid; gap: 10px; background: white; padding: 20px; border-radius: 8px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; }
  input, select, textarea { padding: 10px; border: 1px solid #ddd; border-radius: 4px; }
  
  .status-badge { padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold; }
  .status-badge.active { background: #e8f5e9; color: #2e7d32; }
  .status-badge.banned { background: #ffebee; color: #c62828; }
  
  .action-btn { text-decoration: none; font-size: 12px; background: #eee; padding: 4px 8px; border-radius: 4px; color: #333; }
  .delete-link { color: red; font-size: 12px; }

  @keyframes fadeEffect { from {opacity: 0;} to {opacity: 1;} }
</style>
{% endblock %}